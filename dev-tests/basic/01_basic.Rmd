---
title: 'Basic tests using `abm_regular()` and `abm_variable()`'
output: pdf_document
author: Sasha D. Hafner
date: "`r format(Sys.time(), '%d %B, %Y %H:%M')`"
---

# Overview
Objective is to test relatively basic operation of the `abm()` functions during simplification.

# Prep

```{r}
devtools::load_all()
```

# 1. Regular

```{r}
out0 <- abm(365)
```

```{r}
line_colors <- c('red', 'blue', 'green','orange')
matplot(out0$time, out0[, nn <- c('m0','m1','m2','sr1')]/1000, 
        type = 'l', lty = c(1:length(nn)), col = line_colors, xlab = 'Time (days from 1. Jan)', 
        ylab = 'Microbial biomass (kg)')
legend("topright", legend = nn, lty = c(1:length(nn)), col = line_colors, lwd = 1,
       title = "Microbial biomass", cex = 0.8)
```


```{r}
plot(CH4_emis_rate ~ time, data = out0, type = 'l')
plot(CH4_emis_cum ~ time, data = out0, type = 'l')
plot(COD_load ~ time, data = out0, type = 'l')
plot(slurry_mass ~ time, data = out0, type = 'l')
plot(temp_C ~ time, data = out0, type = 'l')
plot(VSd ~ time, data = out0, type = 'l')
plot(VFA ~ time, data = out0, type = 'l')
plot(VFA_conc ~ time, data = out0, type = 'l')
```

# 2. Regular with startup

```{r}
out1 <- abm(365, startup = 2)
```

```{r}
line_colors <- c('red', 'blue', 'green','orange')
matplot(out1$time, out1[, nn <- c('m0','m1','m2','sr1')]/1000, 
        type = 'l', lty = c(1:length(nn)), col = line_colors, xlab = 'Time (days from 1. Jan)', 
        ylab = 'Microbial biomass (kg)')
legend("topright", legend = nn, lty = c(1:length(nn)), col = line_colors, lwd = 1,
       title = "Microbial biomass", cex = 0.8)
```

```{r}
plot(CH4_emis_rate ~ time, data = out1, type = 'l')
plot(CH4_emis_cum ~ time, data = out1, type = 'l')
plot(COD_load ~ time, data = out1, type = 'l')
plot(slurry_mass ~ time, data = out1, type = 'l')
plot(temp_C ~ time, data = out1, type = 'l')
plot(VSd ~ time, data = out1, type = 'l')
plot(VFA ~ time, data = out1, type = 'l')
plot(VFA_conc ~ time, data = out1, type = 'l')
```

3. Variable 

```{r}
slurry_mass_dat <- data.frame(time = c(0, 1, 10, 15, 30), slurry_mass = c(1000, 7000, 2000, 1500, 3000))
plot(slurry_mass ~ time, data = slurry_mass_dat, type = 'o')
```

Default, with "early" behavior.

```{r}
devtools::load_all()
out2 <- abm(365, delta_t = 0.1, 
            add_pars = list(storage_depth = 4, area = 1000, 
                            slurry_mass = slurry_mass_dat))
```

```{r}
line_colors <- c('red', 'blue', 'green','orange')
matplot(out2$time, out2[, nn <- c('m0','m1','m2','sr1')]/1000, 
        type = 'l', lty = c(1:length(nn)), col = line_colors, xlab = 'Time (days from 1. Jan)', 
        ylab = 'Microbial biomass (kg)')
legend("topright", legend = nn, lty = c(1:length(nn)), col = line_colors, lwd = 1,
       title = "Microbial biomass", cex = 0.8)
```

```{r}
plot(CH4_emis_rate ~ time, data = out2, type = 'l')
plot(CH4_emis_cum ~ time, data = out2, type = 'l')
plot(COD_load ~ time, data = out2, type = 'l')
plot(slurry_mass ~ time, data = out2, type = 'l')
plot(temp_C ~ time, data = out2, type = 'l')
plot(VSd ~ time, data = out2, type = 'l')
plot(VFA ~ time, data = out2, type = 'l')
plot(VFA_conc ~ time, data = out2, type = 'l')
```




